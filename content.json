{"meta":{"title":"灵魂导师","subtitle":"天涯远不远？不远！人就在天涯，天涯怎么会远？","description":null,"author":"i77","url":"http://www.idea7.top"},"pages":[{"title":"About me","date":"2018-08-28T03:26:06.102Z","updated":"2017-03-02T10:39:16.000Z","comments":true,"path":"about/index.html","permalink":"http://www.idea7.top/about/index.html","excerpt":"","text":"I’ve just got nothing to say."}],"posts":[{"title":"CentOS下利用L2TP+IPSec搭建VPN服务","slug":"CentOS using L2TP+IPSec building VPN","date":"2018-08-30T12:30:00.000Z","updated":"2018-08-30T04:36:44.000Z","comments":true,"path":"2018/08/30/CentOS using L2TP+IPSec building VPN/","link":"","permalink":"http://www.idea7.top/2018/08/30/CentOS using L2TP+IPSec building VPN/","excerpt":"","text":"前言在大天朝因为有墙的存在，使人无法愉快的科学上网。作为一名技术宅，没办法谷歌是无法接受的。空闲也没的办法愉快的刷刷INS，刷刷推特，刷刷油管这算哪门子科学上网。（当然作为一名外企狗，在公司的话是不存在这些情况的，主要是在家里） 以前也尝试过各式各样的VPN，免费的收费的，但是最后的结果总是不那么愉快，要么不稳定断断续续的被墙，要么干脆被和谐。于是萌生了自己搭建一个VPN的想法，好歹也算个技术宅，不能辱没这我这一身技术（装x中 别叫醒我） 准备 VPS 首先去搞个美帝的VPS，注意要选一定要可以连接到外网的IP，这是最基本的一步，要不然就没用了。至于VPS的选择，有很多，可以选 Linode 或者 Vultr，根据当前的需求买最低配置的就行，大概5美刀每月，具体购买过程就不说了，请自行百度或者参考这里https://www.cnblogs.com/think8848/p/6347880.html L2TP和IPSec介绍 L2TP协议是一种工业标准的Internet隧道协议，功能大致和PPTP协议类似，比如同样可以对网络数据流进行加密。不过也有不同之处，比如PPTP要求网络为IP网络，L2TP要求面向数据包的点对点连接；PPTP使用单一隧道，L2TP使用多隧道；L2TP提供包头压缩、隧道验证，而PPTP不支持。L2TP协议是由IETF起草，微软、Ascend、 Cisco 、 3COM 等公司参予制定的二层隧道协议，它结合了PPTP和L2F两种二层隧道协议的优点，为众多公司所接受，已经成为IETF有关2层通道协议的工业标准，基于 微软 的点对点隧道协议 (PPTP)和思科2层转发协议(L2F)之上的，被一个因特网服务提供商和公司使用使这个虚拟私有网络的操作能够通过因特网。 IPsec（IP Security），顾名思义，是保障IP层安全的网络技术，它并不是指某一项具体的协议，而是指用于实现IP层安全的协议套件集合。IPsec实质上也是一种隧道传输技术，它将IP分组或IP上层载荷封装在IPsec报文内，并根据需要进行加密和完整性保护处理，以此保证数据在公共网络中传输过程的安全。 IPsec支持两种协议标准，鉴别首部（Authenticaion Header，AH）和封装安全有效载荷（Encapsulation Security Payload，ESP）： 搭建 安装L2TP和IPSec服务 想要使用这两个服务需要安装 xl2tp 和 openswan，(可以能还需要安装ppp服务) 不要考虑安不安全，不熟悉linux的用户就直接用root吧，毕竟root权限最大。 首先，通过工具（我用的是putty）ssh到VPS上，执行命令如下 1yum -y install xl2tp openswan ppp 没有报错就是安装成功了，可以进行下一步动作了 配置IPSec 修改ipsec.conf配置 备份原先的配置 1cp /etc/ipsec.conf /etc/ipsec.conf.bak 注意 leftid 是你主机公网的IP, rightaddresspool是xauth认证可分配到的IP段 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950cat &gt; /etc/ipsec.conf &lt;&lt;EOFversion 2.0config setup virtual-private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!192.168.42.0/24,%v4:!192.168.43.0/24 protostack=netkey interfaces=%defaultroute uniqueids=noconn shared left=%defaultroute leftid=121.123.4.1 # 你的主机IP right=%any encapsulation=yes authby=secret pfs=no rekey=no keyingtries=5 dpddelay=30 dpdtimeout=120 dpdaction=clear ike=3des-sha1,3des-sha2,aes-sha1,aes-sha1;modp1024,aes-sha2,aes-sha2;modp1024 phase2alg=3des-sha1,3des-sha2,aes-sha1,aes-sha2,aes256-sha2_512 sha2-truncbug=yesconn l2tp-psk auto=add leftprotoport=17/1701 rightprotoport=17/%any type=transport phase2=esp also=sharedconn xauth-psk auto=add leftsubnet=0.0.0.0/0 rightaddresspool=192.168.43.10-192.168.43.250 modecfgdns1=8.8.8.8 modecfgdns2=8.8.4.4 leftxauthserver=yes rightxauthclient=yes leftmodecfgserver=yes rightmodecfgclient=yes modecfgpull=yes xauthby=file ike-frag=yes ikev2=never cisco-unity=yes also=sharedEOF 修改预共享密钥 备份密钥文件 1cp /etc/ipsec.secrets /etc/ipsec.secrets.bak 修改密钥 $VPN_IPSEC_PSK为你的密钥 123cat &gt; /etc/ipsec.secrets &lt;&lt;EOF%any %any : PSK \"$VPN_IPSEC_PSK\"EOF 配置L2TP 修改xl2tpd.conf 备份文件 1cp /etc/xl2tpd/xl2tpd.conf /etc/xl2tpd/xl2tpd.conf.bak 修改xl2tpd.conf $L2TP_POOL 是VPN分配的地址 $L2TP_LOCAL 是VPN网关 1234567891011121314cat &gt; /etc/xl2tpd/xl2tpd.conf &lt;&lt;EOF[global]port = 1701[lns default]ip range = $L2TP_POOLlocal ip = $L2TP_LOCALrequire chap = yesrefuse pap = yesrequire authentication = yesname = l2tpdpppoptfile = /etc/ppp/options.xl2tpdlength bit = yesEOF 修改/etc/ppp/options.xl2tpd 备份文件 1cp /etc/ppp/options.xl2tpd /etc/ppp/options.xl2tpd.bak 修改文件 123456789101112131415cat &gt; /etc/ppp/options.xl2tpd &lt;&lt;EOF+mschap-v2ipcp-accept-localipcp-accept-remotems-dns 8.8.8.8ms-dns 8.8.4.4noccpauthmtu 1280mru 1280proxyarplcp-echo-failure 4lcp-echo-interval 30connect-delay 5000EOF 添加VPN用户 备份文件 1cp /etc/ppp/chap-secrets /etc/ppp/chap-secrets.bak 修改文件 $VPN_USER 是用户名 $VPN_PASSWORD 是密码 123cat &gt; /etc/ppp/chap-secrets &lt;&lt;EOF\"$VPN_USER\" l2tpd \"$VPN_PASSWORD\" *EOF 如果需要xauth-psk方式还需要执行 1234567cp /etc/ipsec.d/passwd /etc/ipsec.d/passwd.bakVPN_PASSWORD_ENC=$(openssl passwd -1 \"$VPN_PASSWORD\")cat &gt; /etc/ipsec.d/passwd &lt;&lt;EOF$VPN_USER:$VPN_PASSWORD_ENC:xauth-pskEOF 如果后续还要添加用户可以继续执行123cat &gt;&gt; /etc/ppp/chap-secrets &lt;&lt;EOF\"$VPN_USER\" l2tpd \"$VPN_PASSWORD\" *EOF 注意: cat &gt; 和 cat &gt;&gt; 更新系统配置sysctl.conf 备份文件 1cp /etc/sysctl.conf /etc/sysctl.conf.bak 修改文件 - 64位系统 32位系统 $SHM_MAX 68719476736 4294967296 $SHM_ALL 4294967295 268435456 $SHM_MAX 和 $SHM_MAX 的值参见上表 12345678910111213141516171819202122232425cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF# Added by hwdsl2 VPN scriptkernel.msgmnb = 65536kernel.msgmax = 65536kernel.shmmax = $SHM_MAXkernel.shmall = $SHM_ALLnet.ipv4.ip_forward = 1net.ipv4.conf.all.accept_source_route = 0net.ipv4.conf.all.accept_redirects = 0net.ipv4.conf.all.send_redirects = 0net.ipv4.conf.all.rp_filter = 0net.ipv4.conf.default.accept_source_route = 0net.ipv4.conf.default.accept_redirects = 0net.ipv4.conf.default.send_redirects = 0net.ipv4.conf.default.rp_filter = 0net.ipv4.conf.$net_iface.send_redirects = 0net.ipv4.conf.$net_iface.rp_filter = 0net.core.wmem_max = 12582912net.core.rmem_max = 12582912net.ipv4.tcp_rmem = 10240 87380 12582912net.ipv4.tcp_wmem = 10240 87380 12582912EOF 更新 iptables 备份 1iptables-save &gt; /etc/sysconfig/iptables.bak 执行操作如下，其中 - - $net_iface 网络接口名,一般eth0 $L2TP_NET VPN 网段 $XAUTH_NET xauth 网段 参照上面的配置自己填写1234567891011121314151617iptables -I INPUT 1 -p udp --dport 1701 -m policy --dir in --pol none -j DROPiptables -I INPUT 2 -m conntrack --ctstate INVALID -j DROPiptables -I INPUT 3 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTiptables -I INPUT 4 -p udp -m multiport --dports 500,4500 -j ACCEPTiptables -I INPUT 5 -p udp --dport 1701 -m policy --dir in --pol ipsec -j ACCEPTiptables -I INPUT 6 -p udp --dport 1701 -j DROPiptables -I FORWARD 1 -m conntrack --ctstate INVALID -j DROPiptables -I FORWARD 2 -i \"$net_iface\" -o ppp+ -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTiptables -I FORWARD 3 -i ppp+ -o \"$net_iface\" -j ACCEPTiptables -I FORWARD 4 -i ppp+ -o ppp+ -s \"$L2TP_NET\" -d \"$L2TP_NET\" -j ACCEPTiptables -I FORWARD 5 -i \"$net_iface\" -d \"$XAUTH_NET\" -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPTiptables -I FORWARD 6 -s \"$XAUTH_NET\" -o \"$net_iface\" -j ACCEPTiptables -A FORWARD -j DROPiptables -t nat -I POSTROUTING -s \"$XAUTH_NET\" -o \"$net_iface\" -m policy --dir out --pol none -j MASQUERADEiptables -t nat -I POSTROUTING -s \"$L2TP_NET\" -o \"$net_iface\" -j MASQUERADEiptables-save &gt;&gt; /etc/sysconfig/iptables 更新系统服务 修改权限 12chmod +x /etc/rc.localchmod 600 /etc/ipsec.secrets* /etc/ppp/chap-secrets* /etc/ipsec.d/passwd* 使系统更改生效 1sysctl -e -q -p 添加开机启动 123systemctl enable xl2tpd.servicesystemctl enable ipsec.servicesystemctl eanble iptables.service 重启服务 1systemctl restart xl2tpd ipsec iptables 至此可以愉快的玩耍啦，Forget the fuckin’ wall 一键部署如果按照上述步骤没有部署成功或者嫌太麻烦, github 上有一个一键部署的Solution Follow the steps below 1yum -y install wget 1wget https://git.io/vpnsetup-centos -O /tmp/vpn.sh &amp;&amp; sh /tmp/vpn.sh &amp;&amp; rm -f /tmp/vpn.sh 等待安装完成即可, so easy 最后，请叫我雷锋，技术是用来造福大家的，装完x闪人","categories":[{"name":"Linux","slug":"Linux","permalink":"http://www.idea7.top/categories/Linux/"}],"tags":[{"name":"VPN","slug":"VPN","permalink":"http://www.idea7.top/tags/VPN/"}]},{"title":"Code snippets","slug":"Code-snippets","date":"2017-11-14T13:08:00.000Z","updated":"2017-11-14T13:40:06.000Z","comments":true,"path":"2017/11/14/Code-snippets/","link":"","permalink":"http://www.idea7.top/2017/11/14/Code-snippets/","excerpt":"","text":"Webrequest auto detect proxy settings.If NOT SET, Webrequest automatically use the system proxy. 1WebRequest.DefaultProxy = WebRequest.GetSystemWebProxy(); Use DefaultNetworkCredentials to return system proxy credentials. 1request.Proxy.Credentials = System.Net.CredentialCache.DefaultNetworkCredentials; For example 1234567891011121314151617181920212223242526public static bool UrlResponse(string url)&#123; HttpWebRequest request = WebRequest.Create(url) as HttpWebRequest; request.Proxy.Credentials = System.Net.CredentialCache.DefaultNetworkCredentials; // Setting the Request method HEAD, you can also use GET too. request.Method = \"HEAD\"; try &#123; // Getting the Web Response. using (HttpWebResponse response = request.GetResponse() as HttpWebResponse) &#123; // Returns TRUE if the Status code == 200 if (response.StatusCode == HttpStatusCode.OK) &#123; return true; &#125; &#125; &#125; catch (WebException) &#123; // Discard WebException and return false; &#125; return false;&#125; Reference:https://stackoverflow.com/questions/8808052/c-sharp-getting-proxy-settings-from-internet-explorer WPF Data Binding Trace &amp; CollectionView CommitEdit in DataGrid How to trace in WPF data binding Add Namespace: 1xmlns:diag=\"clr-namespace:System.Diagnostics;assembly=WindowsBase\" Markup in xaml 1&lt;TextBlock Text=\"&#123;Binding Title, diag:PresentationTraceSources.TraceLevel=High&#125;\" /&gt; CollectionView Auto CommitEdit in DataGrid MUST use native datagrid column, eg. DataGridTextColumn.DO NOT use DataGridTemplateColumn Export canvas as image1234567891011121314151617181920212223var size = new Size(DragCanvas.Width, DragCanvas.Height);RenderTargetBitmap rtb = new RenderTargetBitmap((int)size.Width, (int)size.Height, 96d, 96d, PixelFormats.Default);DrawingVisual dv = new DrawingVisual();using (DrawingContext ctx = dv.RenderOpen())&#123; SolidColorBrush brush = new SolidColorBrush(_terminalDetails.BackgroundColor); ctx.DrawRectangle(brush, null, new Rect(new Point(), size)); VisualBrush vb = new VisualBrush(DragCanvas); ctx.DrawRectangle(vb, null, new Rect(new Point(), size));&#125;rtb.Render(dv);PngBitmapEncoder pngEncoder = new PngBitmapEncoder();pngEncoder.Frames.Add(BitmapFrame.Create(rtb));System.IO.MemoryStream ms = new System.IO.MemoryStream();pngEncoder.Save(ms);ms.Close();System.IO.File.WriteAllBytes(file, ms.ToArray()); Block the operation but not block the windows messages pump1234567891011121314151617181920212223242526private void WaitForSent()&#123; List&lt;MessageItem&gt; messages = null; lock (messageToSend) &#123; messages = new List&lt;MessageItem&gt;(this.messageToSend.Values); &#125; var manualReset = new ManualResetEvent(false); var timer = new System.Timers.Timer(100) &#123; Enabled = true &#125;; // System.Windows.Forms.Timer cannot work timer.Elapsed += (o, e) =&gt; &#123; if (messages.FindAll(item =&gt; item.IsSent).Count == messageToSend.Count) &#123; manualReset.Set(); timer.Enabled = false; timer.Stop(); &#125; &#125;; timer.Start(); manualReset.WaitOne(); manualReset.Close();&#125;","categories":[{"name":"编程","slug":"编程","permalink":"http://www.idea7.top/categories/编程/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.idea7.top/tags/C/"}]},{"title":"WOW Font Hacker Plus","slug":"WOW-Font-Hacker-Plus","date":"2017-03-02T13:08:00.000Z","updated":"2017-11-14T13:41:08.000Z","comments":true,"path":"2017/03/02/WOW-Font-Hacker-Plus/","link":"","permalink":"http://www.idea7.top/2017/03/02/WOW-Font-Hacker-Plus/","excerpt":"","text":"前言上一版字体修改器预览非常不方便，看不到具体修改成什么效果是不是自己想要的字体。所以加了个预览效果，方便查看。 预览效果先上效果瞧瞧。 预览的字符串是那段非常有名的，O__O… The quick brown fox jumps over the lazy dog 原理与问题问题当前只有TTF字体文件怎么直接获取到字体然后设置给Label标签预览。谷歌一下在StackOverFlow找到了解决方案。 原理C#的PrivateFontCollection类提供了 AddFontFile 和 AddMemoryFont，先看MSDN怎么说 The PrivateFontCollection is a collection class for fonts. This class keeps a collection of fonts specifically for an application. The fonts in the collection can include installed fonts as well as fonts that have not been installed on the system. 大致意思就是这个类是专门提供给APP来加载自己特有的字体集合的。读出TTF字体内容加载到内存里。目前仅支持 常规，粗体，斜体这三种样式。要是预览不成功，那不好意思，这个字体嗝屁啦，换个吧。 代码12345678PrivateFontCollection privateFontCollection = new PrivateFontCollection();byte[] bytes = File.ReadAllBytes(ttfPath);IntPtr ptr = Marshal.AllocCoTaskMem(bytes.Length);Marshal.Copy(bytes, 0, ptr, bytes.Length);privateFontCollection.AddMemoryFont(ptr, bytes.Length);Marshal.FreeCoTaskMem(ptr);FontFamily fontFamily = privateFontCollection.Families[0]; 下载bin,摸我下载 附上源码，摸我下载","categories":[{"name":"编程","slug":"编程","permalink":"http://www.idea7.top/categories/编程/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.idea7.top/tags/C/"},{"name":"魔兽世界","slug":"魔兽世界","permalink":"http://www.idea7.top/tags/魔兽世界/"}]},{"title":"WOW字体修改器","slug":"WOW-Font-Hacker","date":"2017-02-06T16:13:00.000Z","updated":"2017-11-14T13:42:04.000Z","comments":true,"path":"2017/02/06/WOW-Font-Hacker/","link":"","permalink":"http://www.idea7.top/2017/02/06/WOW-Font-Hacker/","excerpt":"","text":"原理原理很简单，在魔兽世界安装目录下新建一个Fonts文件夹，然后把字体文件拷贝过去分别命名成: ARHei.ttf ARIALN.ttf ARKai_C.ttf ARKai_T.ttf FZL2JW.ttf FZLBJW.ttf FZXHLJW.ttf ZYHei.ttf ZYKai_C.ttf ZYKai_T.ttf 其中，ARXXX这三个和ZYXXX这三个不知道现在版本哪个生效了，就全部都加进去了。 实现懒得复制粘贴，又想经常换字体，庆幸自己是一枚码农，用C#写个小工具，可以选择系统自带字体，或者本地字体文件（仅支持ttf格式） 基于Telerik UI 的Winform，效果如下： 由于本人强迫症，只想要一个exe，不想带其他引用的dll，所以只能通过ILMerge工具将主程序和dll压成一个exe 通过on successful build 加上 Post-build 事件来实现 1if exist \"$(ProjectDir)ILMerge.exe\" \"$(ProjectDir)ILMerge.exe\" /target:winexe /out:\"$(TargetDir)WOW Font Hacker.exe\" \"$(TargetDir)$(TargetFileName)\" \"$(TargetDir)Telerik.WinControls.dll\" \"$(TargetDir)Telerik.WinControls.UI.dll\" \"$(TargetDir)TelerikCommon.dll\" \"$(TargetDir)Telerik.WinControls.Themes.Office2013Light.dll\" 附上源码，点我下载","categories":[{"name":"编程","slug":"编程","permalink":"http://www.idea7.top/categories/编程/"}],"tags":[{"name":"C#","slug":"C","permalink":"http://www.idea7.top/tags/C/"},{"name":"魔兽世界","slug":"魔兽世界","permalink":"http://www.idea7.top/tags/魔兽世界/"}]},{"title":"WOW7.0 德鲁伊一键宏","slug":"WOW7-DRUID-MARCO","date":"2017-01-23T13:04:00.000Z","updated":"2017-01-23T13:17:30.000Z","comments":true,"path":"2017/01/23/WOW7-DRUID-MARCO/","link":"","permalink":"http://www.idea7.top/2017/01/23/WOW7-DRUID-MARCO/","excerpt":"","text":"野德 (单体输出)天赋加点 手动插入宏 单体123456#showtooltip/Startattack/castsequence reset=5 斜掠,野蛮咆哮,撕碎,撕碎,撕碎,撕碎,割裂,撕碎,撕碎,撕碎,撕碎,凶猛撕咬/cast 猛虎之怒/cast 狂暴/script UIErrorsFrame:Clear() 熊德 (守护)天赋加点 手动插入宏 单体1234#showtooltip/Startattack/castsequence reset=5 裂伤,痛击,横扫,横扫/cast 重殴 一个全职业的宏，点我下载 (需要安装GS插件) 来自: http://nga.178.com/read.php?&amp;tid=9623194","categories":[{"name":"游戏","slug":"游戏","permalink":"http://www.idea7.top/categories/游戏/"}],"tags":[{"name":"魔兽世界","slug":"魔兽世界","permalink":"http://www.idea7.top/tags/魔兽世界/"}]}]}